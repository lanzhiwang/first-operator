



* å§“åï¼šèƒ¡å¿—
* å¡å·ï¼š6214 8302 7966 1762
* æ‰“å°æ”¯è¡Œï¼šæ­¦æ±‰åˆ†è¡Œå…³è°·æ”¯è¡Œ
* å¼€æˆ·è¡Œï¼šæ­¦æ±‰åˆ†è¡Œå…³è°·æ”¯è¡Œ
* ç¨åå·¥èµ„ï¼ˆå…·ä½“åˆ°å‡ åˆ†å‡ è§’ï¼‰ï¼š17820.66 - 18856.86 å·¦å³
* å‘å·¥èµ„æ—¥æœŸï¼ˆèŠ‚å‡æ—¥æå‰è¿˜æ˜¯å»¶åï¼‰ï¼šæ¯æœˆæœ€åä¸€ä¸ªå·¥ä½œæ—¥ï¼ŒèŠ‚å‡æ—¥æå‰
* æ‰“å°æ—¥æœŸï¼Œæ‰“å°èµ·æ­¢æ—¥æœŸï¼š2019.06.01 - 2020.04.30  psï¼šæˆ‘ 2020.03 æœˆä»½å·²ç»ç¦»èŒï¼Œæ‰€ä»¥æœ€åä¸€æ¬¡å‘å·¥èµ„çš„æ—¥æœŸæ˜¯ 2020.03.31
* å‘å·¥èµ„å•ä½åç§°-è´¦å·ï¼šé“å®¢ç½‘ç»œç§‘æŠ€ï¼ˆæ­¦æ±‰ï¼‰æœ‰é™å…¬å¸









001 090 013 388 2637

280083

æ­¦æ±‰é‡‘å¢©åˆ†é™¢



æˆåŠŸé¢„è®¢[æ±‰åº­åŒ—äº¬ä¸–çºªé‡‘æºé…’åº—]é«˜çº§åŒåºŠæˆ¿1é—´ï¼Œ9æœˆ20æ—¥-9æœˆ30æ—¥ï¼ˆå…±10æ™šï¼‰ï¼ŒåŒ—äº¬å¸‚æµ·æ·€åŒºè¿œå¤§è·¯1å·BåŒºä¸‰å±‚ä¸–çºªé‡‘æºè´­ç‰©ä¸­å¿ƒåæ¥¼(åœ°é“10å·çº¿é•¿æ˜¥æ¡¥ç«™Aå£æ­¥è¡Œ5åˆ†é’Ÿï¼Œä½äºä¸–çºªé‡‘æºè´­ç‰©ä¸­å¿ƒåŒ—ä¾§ï¼Œé‚»è¿‘ç´«ç«¹é™¢å…¬å›­ã€é¦–éƒ½ä½“è‚²é¦†ã€åŒ—äº¬åŠ¨ç‰©å›­ã€ç‰æ¸Šæ½­å…¬å›­ã€é¢å’Œå›­ã€åœ†æ˜å›­ã€å›½å®¶è¡Œæ”¿å­¦é™¢ã€åŒ—äº¬å¤§å­¦ã€æ¸…åå¤§å­¦ã€ä¸­å›½äººæ°‘å¤§å­¦ã€ä¸­å¤®æ°‘æ—å¤§å­¦ã€åŒ—äº¬ç†å·¥å¤§å­¦ä¸­å…³æ‘æ ¡åŒºã€‚)ï¼Œç”µè¯ï¼š010-88877988ã€åä½ä¼šã€‘





åŒ—äº¬ WiFi

7E78P0AA





é‚®ç®±

jira

wiki http://confluence.alauda.cn/pages/viewpage.action?pageId=67561893

gitlab

devops https://acp-hk-build.alauda.cn/console-devops/workspace/tdsql/pipelines/all/tdsql-installer-chart-freeze


## ç›¸å…³è´¦å·

é‚®ç®±è´¦å·ï¼šzhihu@alauda.io
å¯†ç ï¼šjiXJO567233

confluence å’Œ jira è´¦å·ï¼šzhihu
confluence å’Œ jira å¯†ç ï¼šjixjo567233

è…¾è®¯äº‘
https://acp-hk-build.alauda.cn/console-platform/home/personal-info
è´¦å·ï¼šzhihu@alauda.io
å¯†ç ï¼šjiXJO567233

## äº§å“çš„å†å²

* 2017å¹´5æœˆ **Alauda EE 1.Xï¼ˆACE 1.Xï¼‰**
* 2018å¹´10æœˆ **ACE 2.X**
* 2018å¹´11æœˆå¼€å§‹å¼€å‘ **ACP 1.0**ï¼ŒåŸºäºACP 1.Xï¼Œå¢åŠ äº†ä¸‰ä¸ªæ–°çš„äº§å“ï¼š**DevOps**ã€**ASM(service mesh)**ã€**AML(machine learning)**ã€‚
* 2019å¹´6æœˆç»“åˆ ACE 2.X å’Œ ACP 1.X çš„ä¼˜åŠ¿ï¼Œå‘å¸ƒäº† **ACP 2.0** äº§å“ã€‚å¹³å°é‡‡ç”¨åŒ ACP 1.X ä¸€æ ·çš„ k8s æ‰©å±•æœºåˆ¶å®ç°ï¼Œå¹¶æ”¯æŒå¤šé›†ç¾¤å¤šç§Ÿæˆ·çš„èƒ½åŠ›ã€‚å®¹å™¨å’Œ DevOps åŠŸèƒ½ä¸Šå’Œ ACE 2.X å¯¹é½ï¼ŒåŒæ—¶è¿˜å°† ASMã€AML è¿ç§»åˆ°ACP 2.X ä¸Šã€‚åœ¨ ACP 2.X çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶å¼€å§‹äº†å’Œè…¾è®¯TKEå›¢é˜Ÿå¼€å‘çš„ **TKE 3.0** äº§å“çš„èåˆã€‚
* 2019å¹´9æœˆå‘å¸ƒ ACP 2.x å’Œ TKE 3.0 çš„èåˆäº§å“ **TKE for Alauda 2.3ï¼ˆå³ACP 2.3ï¼‰**ã€‚è¯¥äº§å“çš„é›†ç¾¤ç®¡ç†ã€é›†ç¾¤æ’ä»¶ç®¡ç†é‡‡ç”¨äº† TKE 3.0 çš„æ¨¡å—ï¼Œå…¶å®ƒæ¨¡å—ä»ç„¶ä½¿ç”¨ ACP 2.Xã€‚åæ¥ TKE for Alauda æ”¹åä¸º **TKEä¼ä¸šç‰ˆ**ï¼Œå†…éƒ¨è¿˜ä¹ æƒ¯ç§° ACPã€‚
* 2019å¹´åº• TKEä¼ä¸šç‰ˆ å’Œ **TSFã€TDSQLã€CSP** ç­‰è…¾è®¯äº§å“å¼€å§‹è¿›è¡Œå¯¹æ¥ã€‚åŒæ—¶å¼€å§‹ **TKE PaaS** çš„å¼€å‘ï¼ŒTKE PaaS æ˜¯ä»¥ TKE ä¼ä¸šç‰ˆä¸ºåº•åº§ï¼Œå†åŠ ä¸Šè‹¥å¹²è…¾è®¯äº§å“ï¼ˆæ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€å­˜å‚¨ã€å¾®æœåŠ¡ç­‰ï¼‰åå½¢æˆçš„è¾ƒå®Œæ•´çš„ PaaS å¹³å°ã€‚TKE PaaS å†…éƒ¨æœ‰æ—¶ä¼šä¹ æƒ¯ç§°ä¸º **ACE 3.0**ã€‚
* 2020å¹´3æœˆå‘å¸ƒ **TKEä¼ä¸šç‰ˆ2.9ï¼ˆå³ACP 2.12ï¼‰** ä»¥åŠ **TKE PaaS betaç‰ˆ**ï¼ŒåŒ…å« TSFã€TDSQLã€CSPã€Ti-Matrixç­‰è…¾è®¯äº§å“çš„é›†æˆã€‚
* 2020å¹´6æœˆå‘å¸ƒ **TKEä¼ä¸šç‰ˆ2.12ï¼ˆå³ACP 2.12ï¼‰** ä»¥åŠ **TKE PaaS æ­£å¼ç‰ˆ**ï¼ŒåŒ…å« TSFã€TDSQLã€CSPã€Redisã€CMQã€Codingã€Ti-Matrix ç­‰è…¾è®¯äº§å“çš„é›†æˆã€‚



## è…¾è®¯è·³æ¿æœº

```
è·³æ¿æœºç™»é™†æ–¹æ³•ï¼šhttp://confluence.alauda.cn/pages/viewpage.action?pageId=27172708
# Tencent Yun Chongqing springboard
# jumpserver IP:118.24.213.153
# jumpserver login user: zhihu
# jumpserver port:52022
# jumpserver login key
#####################################
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA2mSPIBBvCu7TgdHeB0LOWxynbocQ5GEzczKh2N0Egft4ICnH
8D9yccSJwFDhloXCxlR0x48tAbNXmnfwox7bLCL9IHBUVDrGcNIRKTKAzFlGxSsm
gdIzc3P85W9/VwQCPeos062chffDZbCAO0608K+0TI2ULJDJ7efnw8Hc+5qTmpk/
JYfmoTNYWlgF52X+sTWvxH2b5ZKXBEDGDSRGWK+ztazwj2HbLeyULijxHq/TF9jf
48ebCamn9Vj1/7ZcyG24jj383+0V+l3im+P0QTQQqeGsAiXLNRtckOdo3G7v1X06
4m7CQ8VJWWwKkDbYob7CZeaePAT1iH+JK3y5/wIDAQABAoIBAQC+yZyzkUfA0FVc
EyCZTUaDGCw5Bau/KB9PYws7LhIzD6Goz3dIrdToCJ+ir8XzvpUiuENw1uallqxQ
WLmTd3BXRZXG0fsJvnL/urSdPe6BFvkZZJH2VdD26nwjX91qAimHN13D6uZTrtg3
rRLJPQAbSBQF0KWCrVaLDM5PGLxZ29n3AidWkjGR+mQiR6l23uCHNwj4GEF+CXrj
GKhsHsj687j8M9klycNsNDSvtDwWOtp+M6BPSaXlnrY+ycLhDJ5LS+2uL9j8tvev
eWXxlFfLL0fKHcs4yZkfpJWOzj8P1MKvNzbAYWUYgIaK0LSJNEIfwpp6nC1t4foe
yD0YJ2bZAoGBAPTaOuYI797U6CMnLO0jue0Qp9uMi9zsYCyxrdAPowbk+9mgO8XI
xEQ/u42bXQB0U1Q7lQOgWZfu6Ue3fp+CNFhlgFkcP/eenTB5iNOb/VsFVuDphkKH
QLbYJbSWuYdDlNOoPxLKgjS1T5l6yo0Ck7XtxG0jGj5/uDSQrpfHbdUbAoGBAORV
8LC9FAxN7aFXehSSgNjBWDiD+F/aOCXhiiHPj30fV6JoDTQNFb+A/2A+L18DOvPW
AlNXVQC7xIWCIqQ+dGebVS0R94y2jm+YbWfXcmh2Tfx2fwZrISqW2zmU4qsxhOfU
k2ULb0/Y784AMkWvCzpUaYkFS8gFdEtQS1WKAlDtAoGAXzye2iixvDeNz1aGh/p0
b/whfijtodGjGt9FXv8mByF7wEst1KFhjbZIaiz7AJk+bC38qPtuvcTkocuCieJo
H9XjFUYCr3rXYypyiPRMmGG8SCEs4qWfCz+JcvOJWE52DdmMJu/zszKusmDrdeuB
rqq700NrCtI8wN1hu5GLa+8CgYEA2ZHmIZJY+wx6RIVlBxs9+MvqcxeU4Ei/vaC2
DVeIozHtQAwjoJhjQ7H4JM28N62NS/B9EMqjbWp9bLW+qn/0TRDezW5UUllVSZKV
lR/enRk1YD3M9eG4natXQvvSLEuoF3sf42VM8GmGvuTDAlEzwqXSVcSdG//Oe0EM
N3qkkFUCgYBbcj7y9X9qZIDHsDeYBWH2Xp0kNZPeOOwAbHoZV3HYYIc2zpeB2GSJ
8DUTwG7OpA8y0aPJRRUdVSi3xBRZtd1LyzX+DD03tPxKZ8AU2Ydh4fetuD4LzxQC
OYhd0IksT1TU6a9l8WVDRBSS+eQFQmuEetFD0p7J0xE2Qtg9ZSet/Q==
-----END RSA PRIVATE KEY-----

# login: ssh root@public_ip

[zhihu@jumpserver ~]$
[zhihu@jumpserver ~]$ ssh root@139.186.122.125
Warning: Permanently added '139.186.122.125' (ECDSA) to the list of known hosts.
Last login: Mon Sep 21 14:53:24 2020 from 61.148.199.18
[root@mw-init ~]#

```

ä¸Šæ‰‹é¡¹ç›®æè¿°ï¼šç¼–å†™ä¸€ä¸ªOperatorï¼Œå®ç°å¯¹äºæŒ‡å®šç¯å¢ƒå˜é‡å†…çš„èµ„æºç›‘æ§ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š
1. åŸºäºOperator-SDKæ¥å®ç°operator
2. æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åˆ·æ–°æ“ä½œ
3. æ¯æ¬¡åˆ·æ–°çš„æ—¶å€™ï¼Œåœ¨stdoutæ‰“å°ä¸‹åˆ—èµ„æºçš„ä¿¡æ¯ï¼š
    deployment, statefulset, secret, configmap, pod, service, endpoint
æ¯ç§ä¿¡æ¯éœ€è¦æ‰“å°name, namespace, kind, statusä»¥åŠå…¶ä»–ä½ è®¤ä¸ºé€‚åˆçš„ä¿¡æ¯
4. ç¼–å†™chartæ¥éƒ¨ç½²è¿™ä¸ªoperator
5. è®¾ç½®æµæ°´çº¿æ¥æ”¯æŒè¿™ä¸ªé¡¹ç›®çš„CI

ç–‘é—®ï¼š
1. å¦‚ä½•æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•è¾“å…¥ï¼Ÿ


CRD
CR



```bash
huzhi@localhost ~ % kind create cluster
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
huzhi@localhost ~ %

huzhi@localhost imooc % pwd
/Users/huzhi/work/code/go_code/imooc
huzhi@localhost imooc %
huzhi@localhost imooc % operator-sdk new imooc-operator --skip-validation=true --repo=github.com/imooc-com/imooc-operator
INFO[0000] Creating new Go operator 'imooc-operator'.
INFO[0000] Created go.mod
INFO[0000] Created tools.go
INFO[0000] Created cmd/manager/main.go
INFO[0000] Created build/Dockerfile
INFO[0000] Created build/bin/entrypoint
INFO[0000] Created build/bin/user_setup
INFO[0000] Created deploy/service_account.yaml
INFO[0000] Created deploy/role.yaml
INFO[0000] Created deploy/role_binding.yaml
INFO[0000] Created deploy/operator.yaml
INFO[0000] Created pkg/apis/apis.go
INFO[0000] Created pkg/controller/controller.go
INFO[0000] Created version/version.go
INFO[0000] Created .gitignore
INFO[0000] Project creation complete.
huzhi@localhost imooc %
huzhi@localhost imooc % ll
total 0
drwxr-xr-x   3 huzhi  staff   96  9 22 13:48 ./
drwxr-xr-x   3 huzhi  staff   96  9 22 13:46 ../
drwxr-x---  10 huzhi  staff  320  9 22 13:48 imooc-operator/
huzhi@localhost imooc %
huzhi@localhost imooc % tree -a imooc-operator
imooc-operator
â”œâ”€â”€ .gitignore
â”œâ”€â”€ build
â”‚Â Â  â”œâ”€â”€ Dockerfile
â”‚Â Â  â””â”€â”€ bin
â”‚Â Â      â”œâ”€â”€ entrypoint
â”‚Â Â      â””â”€â”€ user_setup
â”œâ”€â”€ cmd
â”‚Â Â  â””â”€â”€ manager
â”‚Â Â      â””â”€â”€ main.go
â”œâ”€â”€ deploy
â”‚Â Â  â”œâ”€â”€ operator.yaml
â”‚Â Â  â”œâ”€â”€ role.yaml
â”‚Â Â  â”œâ”€â”€ role_binding.yaml
â”‚Â Â  â””â”€â”€ service_account.yaml
â”œâ”€â”€ go.mod
â”œâ”€â”€ pkg
â”‚Â Â  â”œâ”€â”€ apis
â”‚Â Â  â”‚Â Â  â””â”€â”€ apis.go
â”‚Â Â  â””â”€â”€ controller
â”‚Â Â      â””â”€â”€ controller.go
â”œâ”€â”€ tools.go
â””â”€â”€ version
    â””â”€â”€ version.go

9 directories, 14 files
huzhi@localhost imooc %

huzhi@localhost imooc-operator % go env
GO111MODULE=""
GOARCH="amd64"
GOBIN=""
GOCACHE="/Users/huzhi/Library/Caches/go-build"
GOENV="/Users/huzhi/Library/Application Support/go/env"
GOEXE=""
GOFLAGS=""
GOHOSTARCH="amd64"
GOHOSTOS="darwin"
GOINSECURE=""
GOMODCACHE="/Users/huzhi/go/pkg/mod"
GONOPROXY=""
GONOSUMDB=""
GOOS="darwin"
GOPATH="/Users/huzhi/go"
GOPRIVATE=""
GOPROXY="https://proxy.golang.org,direct"
GOROOT="/usr/local/go"
GOSUMDB="sum.golang.org"
GOTMPDIR=""
GOTOOLDIR="/usr/local/go/pkg/tool/darwin_amd64"
GCCGO="gccgo"
AR="ar"
CC="clang"
CXX="clang++"
CGO_ENABLED="1"
GOMOD="/Users/huzhi/work/code/go_code/imooc/imooc-operator/go.mod"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/4f/gy92m6hd2xj3c6_yz0dht6880000gn/T/go-build588738101=/tmp/go-build -gno-record-gcc-switches -fno-common"
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % ll /Users/huzhi/go
ls: /Users/huzhi/go: No such file or directory
huzhi@localhost imooc-operator %


huzhi@localhost imooc-operator % pwd
/Users/huzhi/work/code/go_code/imooc/imooc-operator
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % operator-sdk add api --api-version=k8s.imooc.com/v1alpha1 --kind=ImoocPod
INFO[0000] Generating api version k8s.imooc.com/v1alpha1 for kind ImoocPod.
INFO[0000] Created pkg/apis/k8s/group.go
INFO[0060] Created pkg/apis/k8s/v1alpha1/imoocpod_types.go
INFO[0060] Created pkg/apis/addtoscheme_k8s_v1alpha1.go
INFO[0060] Created pkg/apis/k8s/v1alpha1/register.go
INFO[0060] Created pkg/apis/k8s/v1alpha1/doc.go
INFO[0060] Created deploy/crds/k8s.imooc.com_v1alpha1_imoocpod_cr.yaml
INFO[0060] Running deepcopy code-generation for Custom Resource group versions: [k8s:[v1alpha1], ]
F0922 14:08:47.478086   10952 deepcopy.go:885] Hit an unsupported type invalid type for invalid type, from ./pkg/apis/k8s/v1alpha1.ImoocPod
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   deploy/role.yaml

Untracked files:
  (use "git add <file>..." to include in what will be committed)

	deploy/crds/
	pkg/apis/addtoscheme_k8s_v1alpha1.go
	pkg/apis/k8s/

no changes added to commit (use "git add" and/or "git commit -a")
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator % operator-sdk add controller --api-version=k8s.imooc.com/v1alpha1 --kind=ImoocPod
INFO[0000] Generating controller version k8s.imooc.com/v1alpha1 for kind ImoocPod.
INFO[0000] Created pkg/controller/imoocpod/imoocpod_controller.go
INFO[0000] Created pkg/controller/add_imoocpod.go
INFO[0000] Controller generation complete.
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git status
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	pkg/controller/add_imoocpod.go
	pkg/controller/imoocpod/

nothing added to commit but untracked files present (use "git add" to track)
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % export GOPROXY=https://goproxy.io
huzhi@localhost imooc-operator % go env GOPROXY
https://goproxy.io
huzhi@localhost imooc-operator % go mod download github.com/operator-framework/operator-sdk@v0.17.0
huzhi@localhost imooc-operator % ll /Users/huzhi/go
total 0
drwxr-xr-x   3 huzhi  staff    96  9 22 14:33 ./
drwxr-xr-x+ 38 huzhi  staff  1216  9 22 14:33 ../
drwxr-xr-x   4 huzhi  staff   128  9 22 14:33 pkg/
huzhi@localhost imooc-operator % ll /Users/huzhi/go/pkg
total 0
drwxr-xr-x  4 huzhi  staff  128  9 22 14:33 ./
drwxr-xr-x  3 huzhi  staff   96  9 22 14:33 ../
drwxr-xr-x  4 huzhi  staff  128  9 22 14:34 mod/
drwxr-xr-x  3 huzhi  staff   96  9 22 14:33 sumdb/
huzhi@localhost imooc-operator % ll /Users/huzhi/go/pkg/mod
total 0
drwxr-xr-x  4 huzhi  staff  128  9 22 14:34 ./
drwxr-xr-x  4 huzhi  staff  128  9 22 14:33 ../
drwxr-xr-x  4 huzhi  staff  128  9 22 14:34 cache/
drwxr-xr-x  3 huzhi  staff   96  9 22 14:34 github.com/
huzhi@localhost imooc-operator % ll /Users/huzhi/go/pkg/mod/github.com/operator-framework/operator-sdk@v0.17.0
total 600
dr-x------  28 huzhi  staff     896  9 22 14:34 ./
drwxr-xr-x   3 huzhi  staff      96  9 22 14:34 ../
dr-xr-xr-x   5 huzhi  staff     160  9 22 14:34 .github/
-r--r--r--   1 huzhi  staff    1427  9 22 14:34 .gitignore
-r--r--r--   1 huzhi  staff     107  9 22 14:34 .gitmodules
-r--r--r--   1 huzhi  staff    7897  9 22 14:34 .travis.yml
-r--r--r--   1 huzhi  staff   81069  9 22 14:34 CHANGELOG.md
-r--r--r--   1 huzhi  staff    2911  9 22 14:34 CONTRIBUTING.MD
-r--r--r--   1 huzhi  staff   11357  9 22 14:34 LICENSE
-r--r--r--   1 huzhi  staff     657  9 22 14:34 MAINTAINERS
-r--r--r--   1 huzhi  staff    8318  9 22 14:34 Makefile
-r--r--r--   1 huzhi  staff     328  9 22 14:34 OWNERS
-r--r--r--   1 huzhi  staff    9064  9 22 14:34 README.md
-r--r--r--   1 huzhi  staff     348  9 22 14:34 SECURITY.md
dr-xr-xr-x   3 huzhi  staff      96  9 22 14:34 cmd/
-r--r--r--   1 huzhi  staff    2971  9 22 14:34 code-of-conduct.md
dr-xr-xr-x  17 huzhi  staff     544  9 22 14:34 doc/
dr-xr-xr-x   3 huzhi  staff      96  9 22 14:34 example/
-r--r--r--   1 huzhi  staff    2386  9 22 14:34 go.mod
-r--r--r--   1 huzhi  staff  142549  9 22 14:34 go.sum
dr-xr-xr-x  11 huzhi  staff     352  9 22 14:34 hack/
dr-xr-xr-x   4 huzhi  staff     128  9 22 14:34 images/
dr-xr-xr-x   9 huzhi  staff     288  9 22 14:34 internal/
dr-xr-xr-x  17 huzhi  staff     544  9 22 14:34 pkg/
-r--r--r--   1 huzhi  staff    2140  9 22 14:34 release.sh
dr-xr-xr-x   6 huzhi  staff     192  9 22 14:34 test/
dr-xr-xr-x   3 huzhi  staff      96  9 22 14:34 version/
dr-xr-xr-x   6 huzhi  staff     192  9 22 14:34 website/
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator % operator-sdk build rubinus/imoocpod-operator
go: downloading sigs.k8s.io/controller-runtime v0.5.2
go: downloading k8s.io/client-go v0.17.4
go: downloading k8s.io/apimachinery v0.17.4
go: downloading k8s.io/klog v1.0.0
go: downloading k8s.io/kube-state-metrics v1.7.2
go: downloading github.com/spf13/pflag v1.0.5
go: downloading k8s.io/api v0.17.4
go: downloading github.com/gogo/protobuf v1.3.1
go: downloading go.uber.org/zap v1.14.1
go: downloading github.com/google/gofuzz v1.0.0
go: downloading golang.org/x/oauth2 v0.0.0-20190604053449-0f29369cfe45
go: downloading github.com/go-logr/logr v0.1.0
go: downloading golang.org/x/net v0.0.0-20200226121028-0de0cce0169b
go: downloading github.com/golang/groupcache v0.0.0-20191027212112-611e8accdfc9
go: downloading github.com/imdario/mergo v0.3.7
go: downloading github.com/evanphx/json-patch v4.5.0+incompatible
go: downloading golang.org/x/time v0.0.0-20191024005414-555d28b269f0
go: downloading github.com/go-logr/zapr v0.1.1
go: downloading k8s.io/utils v0.0.0-20191114200735-6ca3b61696b6
go: downloading github.com/gophercloud/gophercloud v0.6.0
go: downloading github.com/pkg/errors v0.9.1
go: downloading gomodules.xyz/jsonpatch/v2 v2.0.1
go: downloading github.com/davecgh/go-spew v1.1.1
go: downloading github.com/coreos/prometheus-operator v0.38.0
go: downloading sigs.k8s.io/yaml v1.1.0
go: downloading github.com/googleapis/gnostic v0.3.1
go: downloading github.com/prometheus/client_golang v1.5.1
go: downloading cloud.google.com/go v0.49.0
go: downloading golang.org/x/text v0.3.2
go: downloading github.com/hashicorp/golang-lru v0.5.3
go: downloading github.com/Azure/go-autorest v13.3.2+incompatible
go: downloading github.com/Azure/go-autorest/autorest v0.9.3-0.20191028180845-3492b2aff503
go: downloading go.uber.org/atomic v1.6.0
go: downloading github.com/prometheus/procfs v0.0.8
go: downloading github.com/golang/protobuf v1.3.2
go: downloading github.com/Azure/go-autorest/logger v0.1.0
go: downloading github.com/prometheus/common v0.9.1
go: downloading github.com/Azure/go-autorest/tracing v0.5.0
go: downloading gopkg.in/yaml.v2 v2.2.8
go: downloading github.com/prometheus/client_model v0.2.0
go: downloading gopkg.in/fsnotify.v1 v1.4.7
go: downloading github.com/beorn7/perks v1.0.1
go: downloading github.com/google/go-cmp v0.4.0
go: downloading k8s.io/kube-openapi v0.0.0-20191107075043-30be4d16710a
go: downloading github.com/modern-go/reflect2 v1.0.1
go: downloading github.com/json-iterator/go v1.1.9
go: downloading github.com/cespare/xxhash v1.1.0
go: downloading gopkg.in/inf.v0 v0.9.1
go: downloading github.com/cespare/xxhash/v2 v2.1.1
go: downloading go.uber.org/multierr v1.5.0
go: downloading golang.org/x/crypto v0.0.0-20200220183623-bac4c82f6975
go: downloading github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd
go: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1
go: downloading github.com/Azure/go-autorest/autorest/adal v0.8.1-0.20191028180845-3492b2aff503
go: downloading golang.org/x/sys v0.0.0-20200122134326-e047566fdf82
go: downloading github.com/google/uuid v1.1.1
go: downloading github.com/dgrijalva/jwt-go v3.2.0+incompatible
go: downloading github.com/Azure/go-autorest/autorest/date v0.2.0
# github.com/imooc-com/imooc-operator/pkg/apis/k8s/v1alpha1
pkg/apis/k8s/v1alpha1/imoocpod_types.go:47:25: cannot use &ImoocPod literal (type *ImoocPod) as type runtime.Object in argument to SchemeBuilder.Register:
	*ImoocPod does not implement runtime.Object (missing DeepCopyObject method)
pkg/apis/k8s/v1alpha1/imoocpod_types.go:47:38: cannot use &ImoocPodList literal (type *ImoocPodList) as type runtime.Object in argument to SchemeBuilder.Register:
	*ImoocPodList does not implement runtime.Object (missing DeepCopyObject method)
FATA[0057] Failed to build operator binary: failed to exec []string{"go", "build", "-o", "/Users/huzhi/work/code/go_code/imooc/imooc-operator/build/_output/bin/imooc-operator", "-gcflags", "all=-trimpath=/Users/huzhi/work/code/go_code/imooc", "-asmflags", "all=-trimpath=/Users/huzhi/work/code/go_code/imooc", "github.com/imooc-com/imooc-operator/cmd/manager"}: exit status 2
huzhi@localhost imooc-operator % git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   go.mod

Untracked files:
  (use "git add <file>..." to include in what will be committed)

	go.sum

no changes added to commit (use "git add" and/or "git commit -a")
huzhi@localhost imooc-operator % ll /Users/huzhi/go/
total 0
drwxr-xr-x   3 huzhi  staff    96  9 22 14:33 ./
drwxr-xr-x+ 38 huzhi  staff  1216  9 22 14:33 ../
drwxr-xr-x   4 huzhi  staff   128  9 22 14:33 pkg/
huzhi@localhost imooc-operator % ll /Users/huzhi/go/pkg/mod/
total 0
drwxr-xr-x  11 huzhi  staff  352  9 22 14:36 ./
drwxr-xr-x   4 huzhi  staff  128  9 22 14:33 ../
drwxr-xr-x   4 huzhi  staff  128  9 22 14:34 cache/
drwxr-xr-x   3 huzhi  staff   96  9 22 14:36 cloud.google.com/
drwxr-xr-x  24 huzhi  staff  768  9 22 14:36 github.com/
drwxr-xr-x   5 huzhi  staff  160  9 22 14:36 go.uber.org/
drwxr-xr-x   3 huzhi  staff   96  9 22 14:35 golang.org/
drwxr-xr-x   3 huzhi  staff   96  9 22 14:35 gomodules.xyz/
drwxr-xr-x   5 huzhi  staff  160  9 22 14:36 gopkg.in/
drwxr-xr-x   9 huzhi  staff  288  9 22 14:36 k8s.io/
drwxr-xr-x   4 huzhi  staff  128  9 22 14:35 sigs.k8s.io/
huzhi@localhost imooc-operator %


huzhi@localhost imooc-operator % operator-sdk build rubinus/imoocpod-operator
# github.com/imooc-com/imooc-operator/pkg/apis/k8s/v1alpha1
pkg/apis/k8s/v1alpha1/imoocpod_types.go:47:25: cannot use &ImoocPod literal (type *ImoocPod) as type runtime.Object in argument to SchemeBuilder.Register:
	*ImoocPod does not implement runtime.Object (missing DeepCopyObject method)
pkg/apis/k8s/v1alpha1/imoocpod_types.go:47:38: cannot use &ImoocPodList literal (type *ImoocPodList) as type runtime.Object in argument to SchemeBuilder.Register:
	*ImoocPodList does not implement runtime.Object (missing DeepCopyObject method)
FATA[0000] Failed to build operator binary: failed to exec []string{"go", "build", "-o", "/Users/huzhi/work/code/go_code/imooc/imooc-operator/build/_output/bin/imooc-operator", "-gcflags", "all=-trimpath=/Users/huzhi/work/code/go_code/imooc", "-asmflags", "all=-trimpath=/Users/huzhi/work/code/go_code/imooc", "github.com/imooc-com/imooc-operator/cmd/manager"}: exit status 2
huzhi@localhost imooc-operator %


è§£å†³æ–¹å¼æ˜¯æ‰§è¡Œï¼šoperator-sdk generate k8s


huzhi@localhost imooc-operator % operator-sdk generate k8s
INFO[0000] Running deepcopy code-generation for Custom Resource group versions: [k8s:[v1alpha1], ]
INFO[0007] Code-generation complete.
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git status
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go

nothing added to commit but untracked files present (use "git add" to track)
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % operator-sdk build rubinus/imoocpod-operator
INFO[0003] Building OCI image rubinus/imoocpod-operator
Sending build context to Docker daemon  43.22MB
Step 1/7 : FROM registry.access.redhat.com/ubi8/ubi-minimal:latest
latest: Pulling from ubi8/ubi-minimal
0fd3b5213a9b: Pull complete
aebb8c556853: Pull complete
Digest: sha256:5cfbaf45ca96806917830c183e9f37df2e913b187aadb32e89fd83fa455ebaa6
Status: Downloaded newer image for registry.access.redhat.com/ubi8/ubi-minimal:latest
 ---> 28095021e526
Step 2/7 : ENV OPERATOR=/usr/local/bin/imooc-operator     USER_UID=1001     USER_NAME=imooc-operator
 ---> Running in 4eb465ec6005
Removing intermediate container 4eb465ec6005
 ---> 76d2e87b0708
Step 3/7 : COPY build/_output/bin/imooc-operator ${OPERATOR}
 ---> fc9d47754af6
Step 4/7 : COPY build/bin /usr/local/bin
 ---> d6a84c55d362
Step 5/7 : RUN  /usr/local/bin/user_setup
 ---> Running in 1d51b996b409
+ echo 'imooc-operator:x:1001:0:imooc-operator user:/root:/sbin/nologin'
+ mkdir -p /root
+ chown 1001:0 /root
+ chmod ug+rwx /root
+ rm /usr/local/bin/user_setup
Removing intermediate container 1d51b996b409
 ---> c6e6f496dc4f
Step 6/7 : ENTRYPOINT ["/usr/local/bin/entrypoint"]
 ---> Running in e8e80609bd7b
Removing intermediate container e8e80609bd7b
 ---> 531269d4bd98
Step 7/7 : USER ${USER_UID}
 ---> Running in a3e22ada93f5
Removing intermediate container a3e22ada93f5
 ---> a12ab398317b
Successfully built a12ab398317b
Successfully tagged rubinus/imoocpod-operator:latest
INFO[0081] Operator build complete.
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator % operator-sdk generate crds
INFO[0000] Running CRD generator.
INFO[0003] CRD generation complete.
huzhi@localhost imooc-operator % git status
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	deploy/crds/k8s.imooc.com_imoocpods_crd.yaml

nothing added to commit but untracked files present (use "git add" to track)
huzhi@localhost imooc-operator %


mkdir -p ~/docker-data/docker_registry
docker run -d -p 5000:5000 --restart always --name registry -v ~/docker-data/docker_registry:/var/lib/registry registry:2

# kind å®¹å™¨å†…éƒ¨çš„ docker å‘½ä»¤æ˜¯ crictl
root@kind-control-plane:/# crictl images
IMAGE                                      TAG                  IMAGE ID            SIZE
docker.io/kindest/kindnetd                 v20200725-4d6bea59   b77790820d015       119MB
docker.io/rancher/local-path-provisioner   v0.0.14              e422121c9c5f9       42MB
docker.io/rubinus/imoocpod-operator        latest               a12ab398317ba       188MB
k8s.gcr.io/build-image/debian-base         v2.1.0               c7c6c86897b63       53.9MB
k8s.gcr.io/coredns                         1.7.0                bfe3a36ebd252       45.4MB
k8s.gcr.io/etcd                            3.4.13-0             0369cf4303ffd       255MB
k8s.gcr.io/kube-apiserver                  v1.19.1              8cba89a89aaa8       95MB
k8s.gcr.io/kube-controller-manager         v1.19.1              7dafbafe72c90       84.1MB
k8s.gcr.io/kube-proxy                      v1.19.1              47e289e332426       136MB
k8s.gcr.io/kube-scheduler                  v1.19.1              4d648fc900179       65.1MB
k8s.gcr.io/pause                           3.3                  0184c1613d929       686kB
root@kind-control-plane:/#




# åœ¨ imoocpod_types.go æ–‡ä»¶ä¸­å¢åŠ å­—æ®µ
huzhi@localhost imooc-operator % git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   pkg/apis/k8s/v1alpha1/imoocpod_types.go

no changes added to commit (use "git add" and/or "git commit -a")
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git diff
diff --git a/pkg/apis/k8s/v1alpha1/imoocpod_types.go b/pkg/apis/k8s/v1alpha1/imoocpod_types.go
index 6c843ce..65d996f 100644
--- a/pkg/apis/k8s/v1alpha1/imoocpod_types.go
+++ b/pkg/apis/k8s/v1alpha1/imoocpod_types.go
@@ -12,6 +12,7 @@ type ImoocPodSpec struct {
        // INSERT ADDITIONAL SPEC FIELDS - desired state of cluster
        // Important: Run "operator-sdk generate k8s" to regenerate code after modifying this file
        // Add custom validation using kubebuilder tags: https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html
+       Replicas int `json:"replicas"`  // æœŸæœ› pod çš„æ•°é‡
 }

 // ImoocPodStatus defines the observed state of ImoocPod
@@ -19,6 +20,8 @@ type ImoocPodStatus struct {
        // INSERT ADDITIONAL STATUS FIELD - define observed state of cluster
        // Important: Run "operator-sdk generate k8s" to regenerate code after modifying this file
        // Add custom validation using kubebuilder tags: https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html
+       Replicas int `json:"replicas"`  // å®é™…è¿è¡Œçš„ pod çš„æ•°é‡
+       PodNames []string `json:"podNames"`  // å®é™…è¿è¡Œçš„ pod çš„åç§°
 }

 // +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object

huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % operator-sdk generate k8s
INFO[0000] Running deepcopy code-generation for Custom Resource group versions: [k8s:[v1alpha1], ]
INFO[0006] Code-generation complete.
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   pkg/apis/k8s/v1alpha1/imoocpod_types.go
	modified:   pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go

no changes added to commit (use "git add" and/or "git commit -a")
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git diff
diff --git a/pkg/apis/k8s/v1alpha1/imoocpod_types.go b/pkg/apis/k8s/v1alpha1/imoocpod_types.go
index 6c843ce..65d996f 100644
--- a/pkg/apis/k8s/v1alpha1/imoocpod_types.go
+++ b/pkg/apis/k8s/v1alpha1/imoocpod_types.go
@@ -12,6 +12,7 @@ type ImoocPodSpec struct {
        // INSERT ADDITIONAL SPEC FIELDS - desired state of cluster
        // Important: Run "operator-sdk generate k8s" to regenerate code after modifying this file
        // Add custom validation using kubebuilder tags: https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html
+       Replicas int `json:"replicas"`  // æœŸæœ› pod çš„æ•°é‡
 }

 // ImoocPodStatus defines the observed state of ImoocPod
@@ -19,6 +20,8 @@ type ImoocPodStatus struct {
        // INSERT ADDITIONAL STATUS FIELD - define observed state of cluster
        // Important: Run "operator-sdk generate k8s" to regenerate code after modifying this file
        // Add custom validation using kubebuilder tags: https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html
+       Replicas int `json:"replicas"`  // å®é™…è¿è¡Œçš„ pod çš„æ•°é‡
+       PodNames []string `json:"podNames"`  // å®é™…è¿è¡Œçš„ pod çš„åç§°
 }

 // +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object
diff --git a/pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go b/pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go
index 72ab512..0a23ff0 100644
--- a/pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go
+++ b/pkg/apis/k8s/v1alpha1/zz_generated.deepcopy.go
@@ -14,7 +14,7 @@ func (in *ImoocPod) DeepCopyInto(out *ImoocPod) {
        out.TypeMeta = in.TypeMeta
        in.ObjectMeta.DeepCopyInto(&out.ObjectMeta)
        out.Spec = in.Spec
-       out.Status = in.Status
+       in.Status.DeepCopyInto(&out.Status)
        return
 }

@@ -88,6 +88,11 @@ func (in *ImoocPodSpec) DeepCopy() *ImoocPodSpec {
 // DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
 func (in *ImoocPodStatus) DeepCopyInto(out *ImoocPodStatus) {
        *out = *in
+       if in.PodNames != nil {
+               in, out := &in.PodNames, &out.PodNames
+               *out = make([]string, len(*in))
+               copy(*out, *in)
+       }
        return
 }

huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % operator-sdk generate crds
INFO[0000] Running CRD generator.
INFO[0000] CRD generation complete.
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   deploy/crds/k8s.imooc.com_imoocpods_crd.yaml

no changes added to commit (use "git add" and/or "git commit -a")
huzhi@localhost imooc-operator % git diff
diff --git a/deploy/crds/k8s.imooc.com_imoocpods_crd.yaml b/deploy/crds/k8s.imooc.com_imoocpods_crd.yaml
index a9d3b7c..e8b8cc6 100644
--- a/deploy/crds/k8s.imooc.com_imoocpods_crd.yaml
+++ b/deploy/crds/k8s.imooc.com_imoocpods_crd.yaml
@@ -30,9 +30,32 @@ spec:
           type: object
         spec:
           description: ImoocPodSpec defines the desired state of ImoocPod
+          properties:
+            replicas:
+              description: 'INSERT ADDITIONAL SPEC FIELDS - desired state of cluster
+                Important: Run "operator-sdk generate k8s" to regenerate code after
+                modifying this file Add custom validation using kubebuilder tags:
+                https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html'
+              type: integer
+          required:
+          - replicas
           type: object
         status:
           description: ImoocPodStatus defines the observed state of ImoocPod
+          properties:
+            podNames:
+              items:
+                type: string
+              type: array
+            replicas:
+              description: 'INSERT ADDITIONAL STATUS FIELD - define observed state
+                of cluster Important: Run "operator-sdk generate k8s" to regenerate
+                code after modifying this file Add custom validation using kubebuilder
+                tags: https://book-v1.book.kubebuilder.io/beyond_basics/generating_crd.html'
+              type: integer
+          required:
+          - podNames
+          - replicas
           type: object
       type: object
   version: v1alpha1
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator % git diff
diff --git a/pkg/controller/imoocpod/imoocpod_controller.go b/pkg/controller/imoocpod/imoocpod_controller.go
index 46f7ead..9721291 100644
--- a/pkg/controller/imoocpod/imoocpod_controller.go
+++ b/pkg/controller/imoocpod/imoocpod_controller.go
@@ -100,6 +100,39 @@ func (r *ReconcileImoocPod) Reconcile(request reconcile.Request) (reconcile.Resu
                return reconcile.Result{}, err
        }

+       reqLogger.Info("è‡ªå®šä¹‰æ—¥å¿—")
+
+       /*
+       // é€šè¿‡è‡ªå®šä¹‰çš„èµ„æº ImoocPod è·å–å·²ç»å­˜åœ¨çš„ pod
+       lbls := labels.Set{
+               "app": instance.Name,
+       }
+       existingPods := &corev1.PodList{}
+       err = r.client.List(
+               context.TODO(),
+               existingPods,
+               &client.ListOptions{
+                       Namespace: request.Namespace,
+                       LabelSelector: labels.SelectorFromSet(lbls),
+               },
+       )
+       if err != nil {
+               reqLogger.Error(err, "è·å–å·²ç»å­˜åœ¨çš„ pod å¤±è´¥")
+               return reconcile.Result{}, nil
+       }
+
+       // è·å– pod çš„åç§°
+       var existingPodNames []string
+       for _, pod := range existingPods.Items {
+               if pod.GetObjectMeta().GetDeletionTimestamp() != nil {
+                       continue
+               }
+               if pod.Status.Phase == corev1.PodPending || pod.Status.Phase == corev1.PodRunning {
+                       existingPodNames = append(existingPodNames, pod.GetObjectMeta().GetName())
+               }
+       }
+       */
+
        // Define a new Pod object
        pod := newPodForCR(instance)

huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % git commit -am 'æ›´æ–°ä»£ç '
[master 9234886] æ›´æ–°ä»£ç 
 1 file changed, 33 insertions(+)
huzhi@localhost imooc-operator % git diff
huzhi@localhost imooc-operator % git status
On branch master
nothing to commit, working tree clean
huzhi@localhost imooc-operator % operator-sdk generate k8s
INFO[0000] Running deepcopy code-generation for Custom Resource group versions: [k8s:[v1alpha1], ]
INFO[0007] Code-generation complete.
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % operator-sdk build rubinus/imoocpod-operator:v1
INFO[0003] Building OCI image rubinus/imoocpod-operator:v1
Sending build context to Docker daemon  43.28MB
Step 1/7 : FROM registry.access.redhat.com/ubi8/ubi-minimal:latest
 ---> 28095021e526
Step 2/7 : ENV OPERATOR=/usr/local/bin/imooc-operator     USER_UID=1001     USER_NAME=imooc-operator
 ---> Using cache
 ---> 76d2e87b0708
Step 3/7 : COPY build/_output/bin/imooc-operator ${OPERATOR}
 ---> 70e02489cdc2
Step 4/7 : COPY build/bin /usr/local/bin
 ---> e0c9cec43538
Step 5/7 : RUN  /usr/local/bin/user_setup
 ---> Running in 8b3b6d06bacc
+ echo 'imooc-operator:x:1001:0:imooc-operator user:/root:/sbin/nologin'
+ mkdir -p /root
+ chown 1001:0 /root
+ chmod ug+rwx /root
+ rm /usr/local/bin/user_setup
Removing intermediate container 8b3b6d06bacc
 ---> 0f744ac3bf58
Step 6/7 : ENTRYPOINT ["/usr/local/bin/entrypoint"]
 ---> Running in ce89fe52b485
Removing intermediate container ce89fe52b485
 ---> 0664af241ae1
Step 7/7 : USER ${USER_UID}
 ---> Running in 6aefa2f43a2b
Removing intermediate container 6aefa2f43a2b
 ---> 39353446f42c
Successfully built 39353446f42c
Successfully tagged rubinus/imoocpod-operator:v1
INFO[0006] Operator build complete.
huzhi@localhost imooc-operator %

huzhi@localhost imooc-operator %
huzhi@localhost imooc-operator % kind load docker-image rubinus/imoocpod-operator:v1
Image: "rubinus/imoocpod-operator:v1" with ID "sha256:39353446f42c23e2d688f0ae73484fd8f0b642f78508f47560220b88bb8d94a6" not yet present on node "kind-control-plane", loading...
huzhi@localhost imooc-operator %

huzhi@localhost ~ % docker ps -a
CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                       NAMES
3bf8e47a72d4        kindest/node:v1.19.1   "/usr/local/bin/entrâ€¦"   8 hours ago         Up 4 hours          127.0.0.1:55487->6443/tcp   kind-control-plane
huzhi@localhost ~ % docker exec -ti kind-control-plane bash
root@kind-control-plane:/# crictl images
IMAGE                                      TAG                  IMAGE ID            SIZE
docker.io/kindest/kindnetd                 v20200725-4d6bea59   b77790820d015       119MB
docker.io/library/busybox                  latest               6858809bf669c       769kB
docker.io/rancher/local-path-provisioner   v0.0.14              e422121c9c5f9       42MB
docker.io/rubinus/imoocpod-operator        latest               a12ab398317ba       188MB
k8s.gcr.io/build-image/debian-base         v2.1.0               c7c6c86897b63       53.9MB
k8s.gcr.io/coredns                         1.7.0                bfe3a36ebd252       45.4MB
k8s.gcr.io/etcd                            3.4.13-0             0369cf4303ffd       255MB
k8s.gcr.io/kube-apiserver                  v1.19.1              8cba89a89aaa8       95MB
k8s.gcr.io/kube-controller-manager         v1.19.1              7dafbafe72c90       84.1MB
k8s.gcr.io/kube-proxy                      v1.19.1              47e289e332426       136MB
k8s.gcr.io/kube-scheduler                  v1.19.1              4d648fc900179       65.1MB
k8s.gcr.io/pause                           3.3                  0184c1613d929       686kB
root@kind-control-plane:/#
root@kind-control-plane:/#
root@kind-control-plane:/# crictl images
IMAGE                                      TAG                  IMAGE ID            SIZE
docker.io/kindest/kindnetd                 v20200725-4d6bea59   b77790820d015       119MB
docker.io/library/busybox                  latest               6858809bf669c       769kB
docker.io/rancher/local-path-provisioner   v0.0.14              e422121c9c5f9       42MB
docker.io/rubinus/imoocpod-operator        latest               a12ab398317ba       188MB
docker.io/rubinus/imoocpod-operator        v1                   39353446f42c2       188MB
k8s.gcr.io/build-image/debian-base         v2.1.0               c7c6c86897b63       53.9MB
k8s.gcr.io/coredns                         1.7.0                bfe3a36ebd252       45.4MB
k8s.gcr.io/etcd                            3.4.13-0             0369cf4303ffd       255MB
k8s.gcr.io/kube-apiserver                  v1.19.1              8cba89a89aaa8       95MB
k8s.gcr.io/kube-controller-manager         v1.19.1              7dafbafe72c90       84.1MB
k8s.gcr.io/kube-proxy                      v1.19.1              47e289e332426       136MB
k8s.gcr.io/kube-scheduler                  v1.19.1              4d648fc900179       65.1MB
k8s.gcr.io/pause                           3.3                  0184c1613d929       686kB
root@kind-control-plane:/#

huzhi@localhost imooc-operator % git diff
diff --git a/deploy/operator.yaml b/deploy/operator.yaml
index 60c3795..6a64e26 100644
--- a/deploy/operator.yaml
+++ b/deploy/operator.yaml
@@ -19,7 +19,7 @@ spec:
           # todo æ›¿æ¢ä¸ºç”Ÿæˆçš„é•œåƒ
           # kind load docker-image rubinus/imoocpod-operator
           # image: REPLACE_IMAGE
-          image: docker.io/rubinus/imoocpod-operator:latest
+          image: docker.io/rubinus/imoocpod-operator:v1
           command:
           - imooc-operator
           # ç”±äºä½¿ç”¨ kind çš„ç¼˜æ•…ï¼ŒimagePullPolicy éœ€è¦ä¿®æ”¹ä¸º Never
huzhi@localhost imooc-operator %

```



































